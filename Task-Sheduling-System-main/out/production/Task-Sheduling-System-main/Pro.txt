import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;

public class Main {

    static Scanner scanner = new Scanner(System.in);

    static ProjectDoa dao = new ProjectDoa();

    static ProjectScheduler scheduler = new ProjectScheduler();

    public static void main(String[] args) throws Exception {

        while (true) {

            System.out.println("\n===== Intelligent Project Scheduler =====");

            System.out.println("1. Add Project");
            System.out.println("2. View Projects");
            System.out.println("3. Generate Schedule (This Week)");
            System.out.println("4. Generate Schedule (Next Week)");
            System.out.println("5. Exit");

            System.out.print("Enter choice: ");

            int choice = scanner.nextInt();

            switch (choice) {

                case 1:
                    addProject();
                    break;

                case 2:
                    viewProjects();
                    break;

                case 3:
                    generateThisWeekSchedule();
                    break;

                case 4:
                    generateNextWeekSchedule();
                    break;

                case 5:
                    System.exit(0);
            }
        }
    }

    // ADD PROJECT
    static void addProject() throws Exception {

        scanner.nextLine();

        System.out.print("Enter Title: ");
        String title = scanner.nextLine();

        System.out.print("Enter Submission Day (Mon-Sun): ");
        String submissionDay = scanner.nextLine();

        System.out.print("Enter Deadline (days): ");
        int deadline = scanner.nextInt();

        System.out.print("Enter Expected Revenue: ");
        double revenue = scanner.nextDouble();

        project p =
                new project(
                        title,
                        deadline,
                        revenue,
                        submissionDay);

        dao.addProject(p);

        System.out.println("Project added successfully!");
    }

    // VIEW PROJECTS (FIXED METHOD)
    static void viewProjects() throws Exception {

        List<project> list = dao.getAllProjects();

        System.out.println("\n===== Project List =====");

        if (list.isEmpty()) {

            System.out.println("No projects found.");
            return;
        }

        for (project p : list) {

            System.out.println(
                    p.getProjectId()
                            + " | "
                            + p.getTitle()
                            + " | Submission: "
                            + p.getSubmissionDay()
                            + " | Deadline: "
                            + p.getDeadline()
                            + " days | Revenue: "
                            + p.getExpectedRevenue());
        }
    }

    // THIS WEEK SCHEDULE
    static void generateThisWeekSchedule() throws Exception {

        List<project> projects = dao.getAllProjects();

        if (projects.isEmpty()) {

            System.out.println("No projects available.");
            return;
        }

        scanner.nextLine();

        System.out.print("Enter Scheduling Day (Sat/Sun): ");
        String schedulingDay = scanner.nextLine();

        System.out.print("Enter busy days to skip (0-5): ");
        int busyTillDay = scanner.nextInt();

        System.out.print("Enter last week avg profit: ");
        double lastWeekAvg = scanner.nextDouble();

        System.out.print("Enter last three week avg profit: ");
        double lastThreeWeekAvg = scanner.nextDouble();

        List<project> schedule =
                scheduler.generateOptimalSchedule(
                        projects,
                        schedulingDay,
                        busyTillDay,
                        lastWeekAvg,
                        lastThreeWeekAvg);

        System.out.println("\n===== Optimal Schedule for This Week =====");

        int day = busyTillDay + 1;

        double totalProfit = 0;

        for (project p : schedule) {

            System.out.println(
                    "Day "
                            + day++
                            + " → "
                            + p.getTitle()
                            + " | Revenue: "
                            + p.getExpectedRevenue());

            totalProfit += p.getExpectedRevenue();
        }

        System.out.println("\nTotal Expected Profit: " + totalProfit);

        // MISSED PROJECTS
        System.out.println("\n===== Missed Projects =====");

        List<project> missed =
                scheduler.getMissedProjects();

        if (missed.isEmpty())
            System.out.println("None");
        else
            for (project p : missed)
                System.out.println(
                        p.getTitle()
                                + " | Deadline expired");

        // FUTURE PROJECTS
        System.out.println("\n===== Future Projects =====");

        List<project> future =
                scheduler.getFutureProjects();

        if (future.isEmpty())
            System.out.println("None");
        else
            for (project p : future)
                System.out.println(p.getTitle());
    }

    // NEXT WEEK SCHEDULE (FIXED)
    static void generateNextWeekSchedule() throws Exception {

        List<project> future =
                scheduler.getFutureProjects();

        if (future.isEmpty()) {

            System.out.println("No future projects available.");
            return;
        }

        scanner.nextLine();

        System.out.print("Enter last week avg profit: ");
        double lastWeekAvg = scanner.nextDouble();

        System.out.print("Enter last three week avg profit: ");
        double lastThreeWeekAvg = scanner.nextDouble();

        List<project> nextWeekProjects =
                new ArrayList<>();

        for (project p : future) {

            int remaining =
                    p.getRemainingDeadline() - 5;

            if (remaining > 0) {

                project copy =
                        new project(
                                p.getProjectId(),
                                p.getTitle(),
                                "sunday",
                                remaining,
                                p.getExpectedRevenue());

                copy.setRemainingDeadline(remaining);

                nextWeekProjects.add(copy);
            }
        }

        List<project> schedule =
                scheduler.generateOptimalSchedule(
                        nextWeekProjects,
                        "sunday",
                        0,
                        lastWeekAvg,
                        lastThreeWeekAvg);

        System.out.println("\n===== Optimal Schedule for NEXT Week =====");

        int day = 1;
        double totalProfit = 0;

        for (project p : schedule) {

            System.out.println(
                    "Day "
                            + day++
                            + " → "
                            + p.getTitle()
                            + " | Revenue: "
                            + p.getExpectedRevenue());

            totalProfit += p.getExpectedRevenue();
        }

        System.out.println("\nTotal Expected Profit Next Week: " + totalProfit);
    }
}